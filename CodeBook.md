---
title: "CodeBook"
author: "Tamara Costello"
date: "January 30, 2016"
output: html_document
---
## run_analysis.R Description
##Instructions 
The run_analysis.R script obtains publically available data from the UCI website and 
manipulates it to produce a single tidy summarized data subset.

###Input
Input is data collected from accelerometers from the Samsung Galaxy S smartphone as generated by 30 different subjects each undertaking 6 distinct activities in multiple repetition as available at the following URL:

https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip

Details of the original experiments are provided here:

http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones

There were 561 measures taken for the 10299 instances provided in the raw data.

###Output
The output produced is a summarized dataframe in R which contains a single observation for each unique subject/activity combination with the related measurements of mean and standard deviation averaged to a single value.  [Dimension of 180 rows X 68 columns]

###Parameters
No input parameters are required to run the R script.  

###Detailed Description of Study and Variables
The data was provided in a zip archive which run_analysis.R downloads, unzips, and manipulates.  The data is downloaded and summarized each time the script is run.  The raw data represents the measures from the accelerometer on a Samsung Galaxy S smartphone.  The collection of the measures was done with 30 test subjects (people) performing 6 normal activities (e.g. walking) a number of times repeatedly.

The goal of the run_analysis.R is to generate a single, tidy summarized data set which provides the mean measurement for each unique group of measures for every subject/activity combination. 

###Libraries Required
The R script was developed using R version 3.2.2 and requires the additional library of dplyr which is sourced in run_analysis.R.

###Variables
68 Variables are provided in the tidy dataset.  

Two variables provide the points of summary for the remaining measurements in the produced data set

1. subject- a number from 1-30 representing each of the unique participants in the study  
2. activity- the description of the 6 different activities undertaken while measurements were being taken           

The remaining 66 variables in the produced result are described best by taking excerpts from the original documentation that is available in its full original form in the file "features_info.txt" located in the zip archive that is downloaded with the dataset as part of run_analysis.R or at the following url:
https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip

####Excerpt from original data source:
The features selected for this database come from the accelerometer and gyroscope 3-axial raw signals tAcc-XYZ and tGyro-XYZ. These time domain signals (prefix 't' to denote time) were captured at a constant rate of 50 Hz. Then they were filtered using a median filter and a 3rd order low pass Butterworth filter with a corner frequency of 20 Hz to remove noise. Similarly, the acceleration signal was then separated into body and gravity acceleration signals (tBodyAcc-XYZ and tGravityAcc-XYZ) using another low pass Butterworth filter with a corner frequency of 0.3 Hz. 

Subsequently, the body linear acceleration and angular velocity were derived in time to obtain Jerk signals (tBodyAccJerk-XYZ and tBodyGyroJerk-XYZ). Also the magnitude of these three-dimensional signals were calculated using the Euclidean norm (tBodyAccMag, tGravityAccMag, tBodyAccJerkMag, tBodyGyroMag, tBodyGyroJerkMag). 

Finally a Fast Fourier Transform (FFT) was applied to some of these signals producing fBodyAcc-XYZ, fBodyAccJerk-XYZ, fBodyGyro-XYZ, fBodyAccJerkMag, fBodyGyroMag, fBodyGyroJerkMag. (Note the 'f' to indicate frequency domain signals). 

These signals were used to estimate variables of the feature vector for each pattern:  
'-XYZ' is used to denote 3-axial signals in the X, Y and Z directions.

tBodyAcc-XYZ
tGravityAcc-XYZ
tBodyAccJerk-XYZ
tBodyGyro-XYZ
tBodyGyroJerk-XYZ
tBodyAccMag
tGravityAccMag
tBodyAccJerkMag
tBodyGyroMag
tBodyGyroJerkMag
fBodyAcc-XYZ
fBodyAccJerk-XYZ
fBodyGyro-XYZ
fBodyAccMag
fBodyAccJerkMag
fBodyGyroMag
fBodyGyroJerkMag

Additional calculations applied to these basic measures were: 
mean : Mean value
std : Standard deviation
####End of Exceprt

The final set of 66 variables produced  and averaged in the tidy data set are the following 33 variables of mean and 33 variables of std calculations
3. tBodyAccmeanX     
4. tBodyAccmeanY     
5. tBodyAccmeanZ     
6. tBodyAccstdX     
7. tBodyAccstdY     
8. tBodyAccstdZ     
9. tGravityAccmeanX     
10. tGravityAccmeanY     
11. tGravityAccmeanZ      
12. tGravityAccstdX      
13. tGravityAccstdY      
14. tGravityAccstdZ      
15. tBodyAccJerkmeanX      
16. tBodyAccJerkmeanY      
17. tBodyAccJerkmeanZ      
18. tBodyAccJerkstdX      
19. tBodyAccJerkstdY      
20. tBodyAccJerkstdZ      
21. tBodyGyromeanX      
22. tBodyGyromeanY      
23. tBodyGyromeanZ      
24. tBodyGyrostdX      
25. tBodyGyrostdY      
26. tBodyGyrostdZ      
27. tBodyGyroJerkmeanX      
28. tBodyGyroJerkmeanY      
29. tBodyGyroJerkmeanZ      
30. tBodyGyroJerkstdX      
31. tBodyGyroJerkstdY      
32. tBodyGyroJerkstdZ      
33. tBodyAccMagmean      
34. tBodyAccMagstd      
35. tGravityAccMagmean      
36. tGravityAccMagstd      
37. tBodyAccJerkMagmean      
38. tBodyAccJerkMagstd      
39. tBodyGyroMagmean      
40. tBodyGyroMagstd      
41. tBodyGyroJerkMagmean      
42. tBodyGyroJerkMagstd      
43. fBodyAccmeanX      
44. fBodyAccmeanY      
45. fBodyAccmeanZ      
46. fBodyAccstdX      
47. fBodyAccstdY         
48. fBodyAccstdZ      
49. fBodyAccJerkmeanX      
50. fBodyAccJerkmeanY      
51. fBodyAccJerkmeanZ      
52. fBodyAccJerkstdX      
53. fBodyAccJerkstdY      
54. fBodyAccJerkstdZ      
55. fBodyGyromeanX      
56. fBodyGyromeanY      
57. fBodyGyromeanZ      
58. fBodyGyrostdX      
59. fBodyGyrostdY      
60. fBodyGyrostdZ     
61. fBodyAccMagmean     
62. fBodyAccMagstd     
63. fBodyBodyAccJerkMagmean     
64. fBodyBodyAccJerkMagstd       
65. fBodyBodyGyroMagmean          
66. fBodyBodyGyroMagstd     
67. fBodyBodyGyroJerkMagmean      
68. fBodyBodyGyroJerkMagstd     

```{r} 
run_analysis.R
## Programming Assignment - Getting and Cleaning Data
## Read data from SmartPhone Accelerometer and Gyroscope when doing 6 different activities
## 
## Requires "dplyr" package to be loaded

library(dplyr)

## Data provided by UCI Berkley in zip format
## Data must be downloaded and unzipped
FileUrl<-"https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
download.file(FileUrl, destfile="SmartphoneData.zip", mode="wb")
filelist<-c("UCI HAR Dataset/test/X_test.txt", 
            "UCI HAR Dataset/test/y_test.txt", 
            "UCI HAR Dataset/test/subject_test.txt",
            "UCI HAR Dataset/train/X_train.txt",
            "UCI HAR Dataset/train/y_train.txt",
            "UCI HAR Dataset/train/subject_train.txt",
            "UCI HAR Dataset/features.txt",
            "UCI HAR Dataset/activity_labels.txt")
unzip("SmartphoneData.zip", files = filelist, overwrite = TRUE)

## Header for the Measures Data in the format of 2 columns:
## (1) column position, (2) variable names of the 561 columns
MeasureVars<-tbl_df(read.table("UCI HAR Dataset/features.txt", sep="",
                            stringsAsFactors = FALSE, header=FALSE))

## Header for Activity Data in the format of 2 columns:
## (1) column position, (2) variable names of the 561 columns
ActivityCodes<-tbl_df(read.table("UCI HAR Dataset/activity_labels.txt", sep="",
                              stringsAsFactors = FALSE, header=FALSE))

## Read the Training and Testing datasets containing the measurements  
## into a dataframe, apply the column names from the features.txt file
## and merge the two data sets into one producing a df with dim (10299 X 561)
## and remove the punctuation from the column headers
MeasuresTrain<-tbl_df(read.table("UCI HAR Dataset/train/X_train.txt", header=FALSE, 
                        sep="", col.names=MeasureVars$V2, stringsAsFactors = FALSE))
MeasuresTest<-tbl_df(read.table("UCI HAR Dataset/test/X_test.txt", header=FALSE,
                        sep="", col.names=MeasureVars$V2, stringsAsFactors = FALSE))
MeasuresData<-bind_rows(MeasuresTrain, MeasuresTest)
Colnamefix<-gsub("[^A-Za-z0-9]", "",colnames(MeasuresData))
colnames(MeasuresData)<-Colnamefix

## Read in what we will combine to be a single column of activity codes (values of 1-6)
## for each row of measurements and replace them with their associated string value
## as provided in the activity_labels.txt file
ActivityTrain<-tbl_df(read.table("UCI HAR Dataset/train/y_train.txt", sep="", 
                                 stringsAsFactors = FALSE, header=FALSE))
ActivityTest<-tbl_df(read.table("UCI HAR Dataset/test/y_test.txt", sep="", 
                                stringsAsFactors = FALSE, header=FALSE))
ActivityData<-bind_rows(ActivityTrain, ActivityTest) 
ActivityData<-mutate(ActivityData, activity=ActivityCodes$V2[ActivityData$V1]) 
ActivityData<-select(ActivityData,-V1)

## Read in what we will combine to be the single column of subjects (1-30)
## who each perform the 6 activities repeatedly which will be joined to 
## the associated measurement row and give it a descriptive column name
SubjectTrain<-tbl_df(read.table("UCI HAR Dataset/train/subject_train.txt", sep="", 
                                stringsAsFactors = FALSE, header=FALSE))
SubjectTest<-tbl_df(read.table("UCI HAR Dataset/test/subject_test.txt", sep="", 
                               stringsAsFactors = FALSE, header=FALSE))
SubjectData<-bind_rows(SubjectTrain,SubjectTest)
colnames(SubjectData)<-"subject"

## Clear interim files to free memory
rm("SubjectTest", "SubjectTrain", "ActivityTest", "ActivityTrain",
       "MeasuresTest", "MeasuresTrain")

## Select the columns from the full set of 561 measure variables that are
## associated with mean or std
SubsetMeasures<-MeasuresData[,grepl("mean|std",colnames(MeasuresData))]
Index<-grepl("meanFreq",colnames(SubsetMeasures))
SubsetMeasures<-SubsetMeasures[,!(Index)] 

## Assemble a single dataframe which includes the additional 2 columns of Subject
## and Activity to their Measures
SelectData<-bind_cols(SubjectData, ActivityData, SubsetMeasures)

## Calculate the mean of those multiple observations per subject/activity combination
## and produce a second independent tidy data set - "SummaryData"
SummaryData<-SelectData %>%
          group_by(subject, activity) %>%
          summarize_each(funs(mean),-subject,-activity)
rm("ActivityCodes","ActivityData","MeasuresData","MeasureVars","SelectData",
   "SubjectData","SubsetMeasures")
return(SummaryData)
```